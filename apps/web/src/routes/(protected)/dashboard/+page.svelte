<!-- apps/web/src/routes/(protected)/dashboard/+page.svelte -->
<script lang="ts">
  import { authStore } from '$lib/stores/auth.svelte';
  import type { PageData } from './$types';
  import { apiClient } from '$lib/api';
  import type { Book } from '$lib/types';

  export let data: PageData;

  // let books = $state<Book[]>([]);
  // let isLoading = $state(true);

  // $effect es un Rune que se ejecuta cuando el componente se monta
  // y cada vez que sus dependencias cambian.
  // $effect(() => {
  //   async function fetchBooks() {
  //     try {
  //       const fetchedBooks = await apiClient<Book[]>('/books');
  //       books = fetchedBooks;
  //     } catch (error) {
  //       console.error("Error al obtener los libros:", error);
  //     } finally {
  //       isLoading = false;
  //     }
  //   }

  //   fetchBooks();
  // });
</script>

<div class="p-8">
  <h1 class="text-3xl font-bold mb-6">Mi Biblioteca</h1>

  {#if authStore.session.user}
    <p class="mb-4">Bienvenido, {authStore.session.user.name} ({authStore.session.user.email})</p>

    <p>Información usuario: </p>
    <pre class="bg-gray-100 p-4 rounded-lg">
      {JSON.stringify(authStore.session.user, null, 2)}
    </pre>
    <p>{authStore.session.user.name}</p>

  {/if}

  {#if data.books && data.books.length === 0}
    <p>No tienes libros en tu biblioteca. ¡Añade el primero!</p>
  {:else}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      {#each data.books as book (book.id)}
        <a href="/books/{book.id}" class="border p-4 rounded-lg shadow hover:shadow-lg transition-shadow">
          <h2 class="font-bold text-lg">{book.title}</h2>
          <p class="text-gray-600">{book.published_year}</p>
        </a>
      {/each}
    </div>
  {/if}
</div>

<!-- <div class="p-8">
  <h1 class="text-3xl font-bold mb-6">Mi Biblioteca</h1>
  
  {#if authStore.session.user}
    <p class="mb-4">Bienvenido, {authStore.session.user.email}!</p>
  {/if}

  {#if isLoading}
    <p>Cargando libros...</p>
  {:else if books.length === 0}
    <p>No tienes libros en tu biblioteca. ¡Añade el primero!</p>
  {:else}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      {#each books as book (book.id)}
        <div class="border p-4 rounded-lg shadow">
          <h2 class="font-bold text-lg">{book.title}</h2>
          <p class="text-gray-600">{book.published_year}</p>
        </div>
      {/each}
    </div>
  {/if}
</div> -->